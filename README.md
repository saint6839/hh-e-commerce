# ë™ì‹œì„± ì œì–´ ë°©ì‹ì— ëŒ€í•œ ê³ ì°°

ê³¼ì œì˜ ë¬¸ì„œì—ì„œëŠ” ë™ì‹œì„±ì„ ì œì–´í•´ì•¼í•˜ëŠ” ëŒ€ìƒì„ ë‹¤ìŒê³¼ ê°™ì´ ì–¸ê¸‰í•˜ì˜€ë‹¤.

- ìž¬ê³  ê°ì†Œ
- ìœ ì € ìž”ì•¡ ì°¨ê°

ìž¬ê³  ê°ì†Œì˜ ê²½ìš°ì—ëŠ” ì •í™•í•˜ê²Œ ì‚¬ìš©ìžê°€ ì‹¤ì œë¡œ êµ¬ë§¤í•œ ë§Œí¼ë§Œ ì°¨ê°ì´ ì´ë£¨ì–´ì ¸ì•¼í•œë‹¤. ì‹¤ì œë¡œëŠ” 100ê°œê°€ íŒ”ë ¸ëŠ”ë° 80ê°œë§Œ ì°¨ê°ë˜ì–´ì„œ ìž¬ê³ ê°€ ë‚¨ì•„ìžˆëŠ”ê²ƒìœ¼ë¡œ ë³´ì—¬ì„œëŠ” ì•ˆëœë‹¤. ë”°ë¼ì„œ ëª…ë°±í•˜ê²Œ ë™ì‹œì„± ì œì–´ì˜ ëŒ€ìƒì´ ë§žë‹¤ê³  ìƒê°í•œë‹¤.

ê·¸ëŸ¬ë‚˜ ìœ ì € ìž”ì•¡ ì°¨ê°ì˜ ê²½ìš°ì—ëŠ” ì˜ë¬¸ì´ë“ ë‹¤. ìš°ì„  ìž”ì•¡ ì°¨ê°ì€ í•´ë‹¹ ì‚¬ìš©ìž ìŠ¤ìŠ¤ë¡œë§Œì´ ì ‘ê·¼í•  ìˆ˜ ìžˆë‹¤. ì—¬ëŸ¬ ì‚¬ìš©ìžê°€ í•œ ì‚¬ìš©ìžì˜ ìž”ì•¡ì„ ì°¨ê°í•˜ë ¤ë“¤ì§€ëŠ” ëª»í•  ê²ƒì´ë‹¤.
ë§Œì•½ í•œ ì‚¬ìš©ìžì˜ ìž”ì•¡ì— ëŒ€í•´ ë™ì¼í•œ ê¸ˆì•¡ìœ¼ë¡œ 10ë²ˆì˜ ìž”ì•¡ ì°¨ê° ìš”ì²­ì´ ë“¤ì–´ì™€ì„œ, ì´ì— ëŒ€í•´ ëª¨ë‘ ê¹”ë”í•˜ê²Œ ì²˜ë¦¬í•´ì„œ 10ë²ˆì— í•´ë‹¹í•˜ëŠ” ê¸ˆì•¡ì„ ëª¨ë‘ ì°¨ê°ì‹œì¼œì£¼ëŠ”ê²ƒì´ ì˜¤ížˆë ¤ ì‚¬ìš©ìžì—ê²ŒëŠ” ë‹¹í˜¹ìŠ¤ëŸ¬ìš¸ ê²ƒì´ë¼ê³  ìƒê°í•œë‹¤. ë”°ë¼ì„œ ì´ ê²½ìš°ì—ëŠ” í•œë²ˆì˜ ìš”ì²­ë§Œ ì„±ê³µì‹œí‚¤ê±°ë‚˜ ëª¨ë“  ìš”ì²­ì„ ê±°ë¶€ì‹œí‚¤ëŠ” ì²˜ë¦¬ë¥¼ í•˜ëŠ”ê²ƒì´ ì˜¤ížˆë ¤ ìžì—°ìŠ¤ëŸ½ì§€ ì•Šë‚˜ ì‹¶ì€ ìƒê°ì´ ë“¤ì—ˆë‹¤.

## ðŸ‘• ìž¬ê³  ê°ì†Œ ë™ì‹œì„± ì œì–´

### ðŸ’¡ë¹„ê´€ì  ë½ vs ë‚™ê´€ì  ë½

ìž¬ê³ ê°ì†Œì— ëŒ€í•´ì„œ ë™ì‹œì„± ì œì–´ë¥¼ í•˜ê¸° ìœ„í•´ì„œ ì´ˆê¸°ì— ë¹„ê´€ì ë½ì„ ì ìš©í•˜ì˜€ë‹¤. ê·¸ ê·¼ê±°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

1. í‰ì†Œì—ëŠ” ìƒí’ˆ ìž¬ê³  ê°ì†Œ ë¡œì§ì—ì„œ ì¶©ëŒì´ ë§Žì´ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤. ëŒ€ë¶€ë¶„ì˜ ê²½ìš°ì—ëŠ” ë‚™ê´€ì  ë½ìœ¼ë¡œ êµ¬í˜„í•´ë„ ë¬¸ì œê°€ ì—†ìœ¼ë‚˜, íƒ€ìž„ì„¸ì¼ê³¼ ê°™ì€ íŠ¹ìˆ˜í•œ ìƒí™©ì—ì„œëŠ” ë‹¤ëŸ‰ì˜ íŠ¸ëžœìž­ì…˜ ì¶©ëŒì´ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ì¡´ìž¬í•˜ê¸° ë•Œë¬¸ì— ë¹„ê´€ì  ë½ì„ ì‚¬ìš©í•˜ê¸°ë¡œ ê²°ì •í•˜ì˜€ë‹¤.
2. ì¶©ëŒì´ ë§Žì´ ë°œìƒí•˜ë”ë¼ë„ ì½˜ì„œíŠ¸ì˜ íŠ¹ì • ì¢Œì„ì„ ì˜ˆë§¤í•˜ëŠ” ìƒí™© ê°™ì€ ìš”êµ¬ì‚¬í•­ì´ë¼ë©´, ë‚™ê´€ì  ë½ì„ ì´ìš©í•´ êµ¬í˜„í•˜ëŠ”ê²ƒë„ ê´œì°®ë‹¤ê³  ìƒê°í•˜ì˜€ë‹¤. ì™œëƒí•˜ë©´ íŠ¹ì • í•œ ìžë¦¬ì— ëŒ€í•´ì„œ ì¶©ëŒì´ ë°œìƒí•˜ì˜€ë‹¤ëŠ” ê²ƒì€ ì´ë¯¸ ê·¸ ìžë¦¬ëŠ” ì˜ˆë§¤ê°€ ì™„ë£Œë˜ì—ˆë‹¤ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì´ë‹¤. ê·¸ëŸ¬ë‚˜ eì»¤ë¨¸ìŠ¤ì˜ ìƒí’ˆ ìž¬ê³  ê°ì†Œì˜ ê²½ìš°ì—ëŠ” íŠ¹ì •í•œ ì˜· í•œ ë²Œì„ ê³ ë¥´ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, í•œ ì˜µì…˜ì— í•´ë‹¹í•˜ëŠ” ìž¬ê³ ë“¤ ì¤‘ í•˜ë‚˜ë¥¼ ê°ì†Œì‹œí‚¤ëŠ” ê²ƒì´ë¯€ë¡œ ìž¬ê³ ê°€ ë‚¨ì•„ìžˆëŠ” í•œ í•´ë‹¹ ì˜· ì˜µì…˜ì— ë“¤ì–´ì˜¨ ìš”ì²­ì— ëŒ€í•´ì„œëŠ” ëª¨ë‘ ì²˜ë¦¬ë¥¼ ì„±ê³µì‹œì¼œì•¼ í•  ê²ƒ ìœ¼ë¡œ ìƒê°í•˜ì—¬ ë¹„ê´€ì  ë½ì„ ì„ íƒí•˜ì˜€ë‹¤.

### ðŸ’¡ìž¬ê³  ê°ì†Œì—ì„œ ë¹„ê´€ì  ë½ ì„ íƒì— ë”°ë¥¸ ìž¥/ë‹¨ì ê³¼ ì„±ëŠ¥ ë¹„êµ

#### ìž¥ì 

- íƒ€ìž„ ì„¸ì¼ê³¼ ê°™ì´ íŠ¸ëžœìž­ì…˜ ì¶©ëŒì´ ë§Žì´ ë°œìƒí•  ìˆ˜ ìžˆëŠ” í™˜ê²½ì—ì„œ ë°ì´í„° ë¬´ê²°ì„±ì„ ì•ˆì „í•˜ê²Œ ë³´ìž¥í•  ìˆ˜ ìžˆë‹¤.
- ë‚™ê´€ì  ë½ì— ë¹„í•´ ê³ ë ¤í•´ì•¼í•  ë¶€ë¶„ë“¤ì´ ì ì–´ êµ¬í˜„ì´ ìƒëŒ€ì ìœ¼ë¡œ ê°„ë‹¨í•˜ë‹¤.

#### ë‹¨ì 

- íŠ¸ëžœìž­ì…˜ì´ ë°ì´í„°ì— ë½ì„ ìž¡ê³  ìžˆëŠ” ë™ì•ˆ, ë‹¤ë¥¸ íŠ¸ëžœìž­ì…˜ì€ ëŒ€ê¸°í•´ì•¼í•˜ë¯€ë¡œ ì „ì²´ ì‹œìŠ¤í…œ ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥ì„±ì´ ì¡´ìž¬í•œë‹¤.
- ë°ë“œë½ ê°€ëŠ¥ì„±ì´ ì¡´ìž¬í•œë‹¤.

### ðŸ’¡ë¹„ê´€ì  ë½ vs ë‚™ê´€ì  ë½ ì„±ëŠ¥ ì¸¡ì •

ì—¬ê¸°ê¹Œì§€ê°€ ë‚´ê°€ ì§ì ‘ ì„±ëŠ¥ ì¸¡ì •ì„ í•˜ê¸° ì „ê¹Œì§€ ì•Œê³  ìžˆë˜ ë‚´ìš©ì´ë‹¤. ì´ ë‚´ìš©ì„ ì¦ëª…í•˜ê¸° ìœ„í•´ì„œ ë¹„ê´€ì  ë½ê³¼ ë‚™ê´€ì  ë½ìœ¼ë¡œ ê°ê° ìž¬ê³  ê°ì†Œ ë¡œì§ì„ êµ¬í˜„í•˜ì—¬ ì„±ëŠ¥ì„ ì¸¡ì •í•´ë³´ì•˜ë‹¤.

#### í…ŒìŠ¤íŠ¸ ì¡°ê±´

1. 100ê°œì˜ ìž¬ê³ ê°€ ì¡´ìž¬
2. ê° ìš”ì²­ì—ì„œ ì‚¬ìš©ìž 100ëª…ì´ ë™ì‹œì— 1ê°œì˜ ìž¬ê³  ê°ì†Œ ìš”ì²­ì„ ë³´ëƒ„
3. í…ŒìŠ¤íŠ¸ ê²°ê³¼ 0ê°œì˜ ìž¬ê³ ê°€ ë‚¨ì•„ì•¼í•¨
   ì´ë•Œ ë‚™ê´€ì  ë½ì˜ ê²½ìš° ìž¬ì‹œë„ë¥¼ 50ë²ˆê¹Œì§€ ì‹œë„í•˜ë„ë¡ í•˜ì˜€ë‹¤. (ìž¬ê³ ê°ì†Œì˜ ê²½ìš°ì—ëŠ” ì–´ë–»ê²Œë“  ì„±ê³µì„ ì‹œì¼œì•¼í•˜ë¯€ë¡œ)

#### í…ŒìŠ¤íŠ¸ ê²°ê³¼

- ë¹„ê´€ì  ë½
  ![alt text](docs/images/á„Œá…¢á„€á…©á„€á…¡á†·á„‰á…©_á„‡á…µá„€á…ªá†«á„Œá…¥á†¨á„…á…¡á†¨_100á„€á…¢.png)

- ë‚™ê´€ì  ë½
  ![alt text](docs/images/á„Œá…¢á„€á…©á„€á…¡á†·á„‰á…©_á„‚á…¡á†¨á„€á…ªá†«á„Œá…¥á†¨á„…á…¡á†¨_100á„€á…¢.png)

ì•„ë¬´ë¦¬ ìž¬ì‹œë„ë¥¼ í•˜ë”ë¼ë„ ê·¸ëž˜ë„ ë½ì„ ìž¡ì§€ ì•ŠëŠ” ë‚™ê´€ì  ë½ì´ ì²˜ë¦¬ ì†ë„ì—ì„œ ìš°ìœ„ì— ìžˆì„ ê²ƒì´ë¼ê³  ìƒê°í•˜ì˜€ë‹¤. ê·¸ëŸ¬ë‚˜ ê·¸ ê²°ê³¼ëŠ” ì˜ˆìƒì„ ë¹—ë‚˜ê°”ë‹¤. ë‚™ê´€ì  ë½ì—ì„œ ì—¬ëŸ¬ë²ˆì˜ ì¶©ëŒì´ ë°œìƒí•˜ë©° ì„±ê³µì„ ë³´ìž¥í•˜ê¸°ìœ„í•´ ìž¬ì‹œë„ê°€ ë°˜ë³µí•´ì„œ ë°œìƒí•˜ì˜€ê³ , ì´ì— ë”°ë¼ ì²˜ë¦¬ ì†ë„ê°€ 2ë°°~3ë°° ê°€ëŸ‰ ë¹„ê´€ì  ë½ë³´ë‹¤ ëŠë ¤ì§€ëŠ” ê²½ìš°ê°€ ë°œìƒí•˜ì˜€ë‹¤.

ì´ ë¹„êµ í…ŒìŠ¤íŠ¸ì˜ ê²°ê³¼ì™€ íƒ€ìž„ ì„¸ì¼ê³¼ ê°™ì€ ëŒ€ëŸ‰ íŠ¸ëžœìž­ì…˜ ì¶©ëŒ ìƒí™©ì˜ íŠ¹ìˆ˜ì„±ì„ ê³ ë ¤í•˜ì˜€ì„ë•Œ, ë”ìš± ë” ìž¬ê³ ê°ì†Œ ë¡œì§ì— ë¹„ê´€ì  ë½ì„ ì‚¬ìš©í•˜ì§€ ì•Šì„ ì´ìœ ê°€ ì—†ì–´ë³´ì˜€ë‹¤.

### ðŸ’¡ë¹„ê´€ì  ë½ì´ë©´ ì¶©ë¶„í• ê¹Œ?

ë¹„ê´€ì  ë½ì„ ì‚¬ìš©í•˜ëŠ”ê²ƒì´ ë‚™ê´€ì  ë½ì— ë¹„í•´ì„œëŠ” ë” ë‚˜ì€ ì„ íƒì´ë¼ëŠ” ê²ƒì´ ëª…ë°±í•´ì¡Œë‹¤. ê·¸ë ‡ë‹¤ë©´ ì´ë ‡ê²Œ ê²€ì¦ëœ ë¹„ê´€ì  ë½ì´ë¼ë©´ ê·¸ ì–´ë–¤ ìƒí™©ì—ì„œë„ ë§ŒëŠ¥ì¼ê¹Œ?

ì´ë¥¼ í™•ì¸í•´ë³´ê¸° ìœ„í•´ í…ŒìŠ¤íŠ¸ ì¡°ê±´ì—ì„œ íŠ¸ëž˜í”½ì„ ì¡°ê¸ˆ ë” ì¶”ê°€í•´ë³´ì•˜ë‹¤.

#### í…ŒìŠ¤íŠ¸ ì¡°ê±´

1. 1000ê°œì˜ ìž¬ê³ ê°€ ì¡´ìž¬
2. ê° ìš”ì²­ì—ì„œ ì‚¬ìš©ìž 1000ëª…ì´ ë™ì‹œì— 1ê°œì˜ ìž¬ê³  ê°ì†Œ ìš”ì²­ì„ ë³´ëƒ„

   - ê° ìš”ì²­ì—ì„œì˜ ë¡œì§ ì²˜ë¦¬ ì†ë„ë¥¼ ë¡œê¹…í•¨

3. í…ŒìŠ¤íŠ¸ ê²°ê³¼ 0ê°œì˜ ìž¬ê³ ê°€ ë‚¨ì•„ì•¼í•¨

#### í…ŒìŠ¤íŠ¸ ê²°ê³¼

- ë¹„ê´€ì  ë½
  ![alt text](docs/images/á„Œá…¢á„€á…©á„€á…¡á†·á„‰á…©_á„‡á…µá„€á…ªá†«á„Œá…¥á†¨á„…á…¡á†¨_á„‰á…¡á†¼á„‰á…¦_1000á„€á…¢.png)

ë‹¨ 1000ê°œì˜ ë™ì‹œ íŠ¸ëž˜í”½ë§Œ ë°œìƒí•˜ë”ë¼ë„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë‚´ì—ì„œ ê° ì¿¼ë¦¬ í•˜ë‚˜í•˜ë‚˜ê°€ ì²˜ë¦¬ëœ ì‹œê°„ì€ í¬ê²Œ ì°¨ì´ê°€ ì—†ìœ¼ë‚˜, í•œ íŠ¸ëžœìž­ì…˜ ì „ì²´ ì²˜ë¦¬ ì‹œê°„ì€ í¬ê²Œ ì¦ê°€í•œê²ƒì„ í™•ì¸í•  ìˆ˜ ìžˆì—ˆë‹¤. ì´ê²ƒì€ ì–´ë–¤ ê²ƒì„ ì˜ë¯¸í• ê¹Œ?

ë¹„ê´€ì  ë½ì˜ íŠ¹ì„±ìƒ í•œ íŠ¸ëžœìž­ì…˜ì”© dbë½ì„ íšë“í•˜ê²Œ ë˜ê³ , í•´ë‹¹ íŠ¸ëžœìž­ì…˜ì´ ë½ì„ í•´ì œí•˜ê¸° ì „ê¹Œì§€ ë‹¤ë¥¸ íŠ¸ëžœìž­ì…˜ë“¤ì€ ëŒ€ê¸°í•˜ê²Œëœë‹¤. ìš”ì²­ì´ ì ì  ëŠ˜ì–´ë‚ ìˆ˜ë¡ ë½ íšë“ì„ ëŒ€ê¸°í•˜ëŠ” íŠ¸ëžœìž­ì…˜ì€ ì ì  ëŠ˜ì–´ë‚˜ê²Œ ë˜ê³ , db ì»¤ë„¥ì…˜ í’€ê¹Œì§€ ê³ ê°ˆë˜ë©° ì „ì²´ íŠ¸ëžœìž­ì…˜ì˜ ì²˜ë¦¬ ì†ë„ê°€ ëŠë ¤ì§€ê²Œ ëœë‹¤.

ì„œë¹„ìŠ¤ì— 100ëª… ì´í•˜ì˜ TPSë§Œ ë°œìƒí•œë‹¤ëŠ” ë³´ìž¥ì´ ì—†ê¸° ë•Œë¬¸ì— ê°œì„ ë˜ì–´ì•¼í•  ë¶€ë¶„ì´ë¼ê³  ìƒê°í•œë‹¤. ì´ ë¶€ë¶„ì€ ì–´ë–»ê²Œ ê°œì„ í•  ìˆ˜ ìžˆì„ê¹Œ? í˜„ìž¬ ë¬¸ì œì ì„ ë‹¤ìŒê³¼ ê°™ì´ ìš”ì•½í•´ë³¼ ìˆ˜ ìžˆë‹¤.

- ë°ì´í„°ë² ì´ìŠ¤ê°€ ëª¨ë“  ë½ì„ ê´€ë¦¬í•˜ê³  ìžˆìœ¼ë©°, ì´ ë½ì€ íŠ¸ëžœìž­ì…˜ì´ ì‹œìž‘ëœ í›„ì— íšë“í•˜ê¸° ë•Œë¬¸ì— í•œ íŠ¸ëžœìž­ì…˜ì´ ê³¼ë„í•˜ê²Œ ì˜¤ëž˜ ìœ ì§€ë˜ëŠ” ê²½ìš°ê°€ ë°œìƒí•œë‹¤.

ê²°êµ­ ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” ë½ì— ëŒ€í•œ ê´€ë¦¬ë¥¼ DBê°€ ì•„ë‹Œ ë‹¤ë¥¸ ê³³ì—ì„œ ë‹´ë‹¹í•˜ë„ë¡ í•´ì•¼í•œë‹¤. ê·¸ë¦¬ê³  ë½ì„ ë¨¼ì € íšë“í•˜ê³  íŠ¸ëžœìž­ì…˜ì„ ì‹¤í–‰í•˜ë„ë¡ í•´ì„œ ê° íŠ¸ëžœìž­ì…˜ì´ ì§§ê²Œ ìœ ì§€ë˜ì–´ì§€ë„ë¡ í•˜ê³ , ê·¸ëŸ¬ë©´ì„œ ë™ì‹œì— scale out ë˜ì–´ìžˆëŠ” ì—¬ëŸ¬ëŒ€ì˜ ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ì—ì„œë„ ë½ ê´€ë¦¬ê°€ ìž˜ ì´ë£¨ì–´ì ¸ì•¼í•œë‹¤.

### ðŸ’¡Redis ê¸°ë°˜ì˜ ë¶„ì‚° ë½ ì ìš©

#### Redis ê¸°ë°˜ì˜ ë¶„ì‚° ë½ì„ ì„ íƒí•œ ì´ìœ 

ìµœì¢…ì ìœ¼ë¡œ ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ì™€ ë³„ê°œë¡œ redis ì„œë²„ë¥¼ ë°°ì¹˜í•˜ì—¬, redisê°€ ì—¬ëŸ¬ëŒ€ì˜ ë¶„ì‚°ëœ ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ì˜ ë½ì„ ê´€ë¦¬í•  ìˆ˜ ìžˆë„ë¡ êµ¬í˜„í•˜ì˜€ë‹¤. ê·¸ ê·¼ê±°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

- eì»¤ë¨¸ìŠ¤ í”„ë¡œì íŠ¸ëŠ” scale outëœ ì„œë²„ ì• í”Œë¦¬ì¼€ì´ì…˜ í™˜ê²½ì„ ê°€ì •í•œë‹¤.
- ë¹„ê´€ì  ë½ì˜ ê²½ìš° ìš”ì²­ì´ ë§Žì•„ì§ˆìˆ˜ë¡ íŠ¸ëžœìž­ì…˜ì„ ì‹œìž‘í•œ ìƒíƒœì—ì„œ ë½ì„ ëŒ€ê¸°í•˜ê¸° ë•Œë¬¸ì—, DBì˜ ì»¤ë„¥ì…˜ì„ ê³„ì† ì°¨ì§€í•˜ê³  ìžˆê²Œ ëœë‹¤. ì´ëŠ” DBì˜ ë¶€í•˜ê°€ ì‹¬í•´ì§€ëŠ”ê²ƒì„ ì˜ë¯¸í•˜ê¸° ë•Œë¬¸ì—, ì´ë¥¼ í•´ì†Œì‹œì¼œì¤„ ë°©ë²•ì´ í•„ìš”í•˜ë‹¤.
- RedisëŠ” in-memory ê¸°ë°˜ìœ¼ë¡œ ë§¤ìš° ë¹ ë¥¸ ìš”ì²­ ì„±ëŠ¥ì„ ë³´ì—¬ì¤€ë‹¤. ë˜í•œ ì‹±ê¸€ ìŠ¤ë ˆë“œ ê¸°ë°˜ì´ê¸° ë•Œë¬¸ì— ë™ì‹œì„± ì²˜ë¦¬ì— ì í•©í•˜ë‹¤.

ìœ„ì™€ ê°™ì€ ì´ìœ ë¡œ ë¶„ì‚° ë½ ë°©ì‹ì„ ì„ íƒí•˜ì˜€ê³ , ê·¸ ì¤‘ì—ì„œë„ Redisë¥¼ ì‚¬ìš©í•˜ì—¬ ë¶„ì‚° ë½ì„ êµ¬í˜„í•˜ê¸°ë¡œ ê²°ì •í•˜ì˜€ë‹¤.

#### Spinlock vs Redlock vs Pub/Sub

**Spinlock**

- ì´ ë°©ì‹ì€ ë‹¨ì¼ ë…¸ë“œì—ì„œ ê°€ìž¥ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìžˆëŠ” ë½ ë°©ì‹ì´ë‹¤.
- CPU ìžì›ì„ ê³„ì†í•´ì„œ ì‚¬ìš©í•˜ë©°, ë½ì´ í•´ì œë ë•Œ ê¹Œì§€ ë¬´í•œí•˜ê²Œ ë°˜ë³µí•˜ë©° ë½ íšë“ì„ ëŒ€ê¸°í•œë‹¤.
- ìž¥ì 
  - delayê°€ ì§§ë‹¤ -> ë¹ ë¥´ê²Œ ë½ íšë“ ê°€ëŠ¥
- ë‹¨ì 
  - CPU ì§‘ì•½ì ì´ê¸° ë•Œë¬¸ì—, ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ë½ íšë“ì„ ì‹œë„í•  ê²½ìš° ì‹¬ê°í•œ ì„±ëŠ¥ ì €í•˜ê°€ ë°œìƒí•  ìˆ˜ ìžˆë‹¤.
  - ì¼ë°˜ì ìœ¼ë¡œ ë‹¨ì¼ ë…¸ë“œì—ì„œ ìž‘ë™í•˜ë¯€ë¡œ, í•´ë‹¹ ë‹¨ì¼ ë…¸ë“œì— ìž¥ì• ê°€ ìƒê²¼ì„ë•Œ ëª¨ë“  ë½ ë©”ì»¤ë‹ˆì¦˜ë„ ì¤‘ë‹¨ëœë‹¤.

**Redlock**

- ë¶„ì‚° í™˜ê²½ì—ì„œ ì‹ ë¢°í•  ìˆ˜ ìžˆëŠ” ë½ì„ ì œê³µí•˜ê¸° ìœ„í•´ ì„¤ê³„ëœ ì•Œê³ ë¦¬ì¦˜ì´ë‹¤.
- ì—¬ëŸ¬ê°œì˜ Redis ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ê³¼ë°˜ìˆ˜ì˜ ë½ì„ íšë“í•˜ëŠ”ê²ƒì„ ëª©í‘œë¡œ í•œë‹¤.
- ìž¥ì 
  - ì—¬ëŸ¬ê°œì˜ ë…¸ë“œë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—, í•œ ê°œì˜ ë…¸ë“œì— ìž¥ì• ê°€ ë°œìƒí•˜ë”ë¼ë„ ë‹¤ë¥¸ ë…¸ë“œë¡œ ë½ ë©”ì»¤ë‹ˆì¦˜ì„ ìœ ì§€í•  ìˆ˜ ìžˆë‹¤.
- ë‹¨ì 
  - delayê°€ ê¸¸ë‹¤
  - ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ ê°„ì˜ í†µì‹ ìœ¼ë¡œ ì¸í•´ ë„¤íŠ¸ì›Œí¬ ë¹„ìš©ì´ ë°œìƒí•œë‹¤.

**Pub/Sub**

- ë¶„ì‚° ì‹œìŠ¤í…œì—ì„œ ì´ë²¤íŠ¸ ê¸°ë°˜ í†µì‹ ì„ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì´ë‹¤.
- ìž¥ì /ë‹¨ì  (ë¸Œë¡œì»¤ì˜ ì„±ëŠ¥ì— ì˜ì¡´í•¨)
  - ë©”ì‹œì§€ ë¸Œë¡œì»¤ ì²˜ë¦¬ ëŠ¥ë ¥ì— ë”°ë¼ ì‹¤ì‹œê°„ì— ê°€ê¹Œìš´ ì„±ëŠ¥ì„ ë³´ì¼ ìˆ˜ ìžˆë‹¤.
  - ë©”ì‹œì§€ ë¸Œë¡œì»¤ì˜ ì‹ ë¢°ì„±ì— ë”°ë¼ ë©”ì‹œì§€ ì†ì‹¤ ê°€ëŠ¥ì„±ì´ ì¡´ìž¬í•œë‹¤.
  - ë©”ì‹œì§€ ë¸Œë¡œì»¤ ë¶€í•˜ì— ë”°ë¼ ìžì› ë¹„ìš©ì´ ë‹¬ë¼ì§„ë‹¤.

ì´ ì¤‘ì—ì„œ Redlock ë°©ì‹ê³¼ Pub/Sub ë°©ì‹ì„ ì‚¬ìš©í•´ì„œ ì„±ëŠ¥ì„ ë¹„êµí•´ë³´ì•˜ë‹¤. í…ŒìŠ¤íŠ¸ ì¡°ê±´ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

1. 1000ê°œì˜ ìž¬ê³ ê°€ ì¡´ìž¬
2. ê° ìš”ì²­ì—ì„œ ì‚¬ìš©ìž 1000ëª…ì´ ë™ì‹œì— 1ê°œì˜ ìž¬ê³  ê°ì†Œ ìš”ì²­ì„ ë³´ëƒ„
   - ê° ìš”ì²­ì—ì„œì˜ ë¡œì§ ì²˜ë¦¬ ì†ë„ë¥¼ ë¡œê¹…í•¨
3. í…ŒìŠ¤íŠ¸ ê²°ê³¼ 0ê°œì˜ ìž¬ê³ ê°€ ë‚¨ì•„ì•¼í•¨

### ë¶„ì‚°ë½ ë°©ì‹ì— ë”°ë¥¸ ì„±ëŠ¥ ë¹„êµ

#### Redlock

- Redlock ë°©ì‹ í…ŒìŠ¤íŠ¸ ê²°ê³¼
  ![alt text](docs/images/ìž¬ê³ ê°ì†Œ_Redlock_1000ê°œ.png)

ì´ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ê¸° ì „ê¹Œì§€ëŠ” in-memory ê¸°ë°˜ì˜ redisë¥¼ ì‚¬ìš©í•˜ëŠ” ë¶„ì‚°ë½ ë°©ì‹ì´ í•œ ìš”ì²­ì˜ ì „ì²´ ì²˜ë¦¬ ì‹œê°„ì´ ë¹„ê´€ì  ë½ ë°©ì‹ë³´ë‹¤ ë” ë¹ ë¥¼ ê²ƒìœ¼ë¡œ ì˜ˆìƒí•˜ì˜€ë‹¤. ê·¸ëŸ¬ë‚˜ ê·¸ ê²°ê³¼ëŠ” ë³´ê¸° ì¢‹ê²Œ ë¹—ë‚˜ê°”ë‹¤.

ì´ì „ì— 1000ê°œì˜ ë™ì‹œ ìš”ì²­ì— ëŒ€í•´ì„œ ê°€ìž¥ ë§ˆì§€ë§‰ ìš”ì²­ì„ 6000msëŒ€ë¡œ ë§ˆë¬´ë¦¬ ì§€ì—ˆë‹¤ë©´, ì´ë²ˆ Redlock ë°©ì‹ì˜ redis ë¶„ì‚°ë½ì€ ê°€ìž¥ ë§ˆì§€ë§‰ ìš”ì²­ì„ 11000ms ëŒ€ë¡œ ë§ˆë¬´ë¦¬ì§€ì—ˆë‹¤. ë¬´ë ¤ 2ë°° ê°€ê¹Œì´ ëŠë¦° ê²°ê³¼ì˜€ë‹¤.

ì´ ê²°ê³¼ì— ëŒ€í•´ì„œ ì–´ë–¤ ì´ìœ ë•Œë¬¸ì¸ì§€ ê³ ë¯¼í•˜ì˜€ê³ , ë‹¤ìŒê³¼ ê°™ì´ ì¶”ì¸¡í•´ë³¼ ìˆ˜ ìžˆì—ˆë‹¤.

ë½ì„ íšë“í•´ì•¼ë§Œ íŠ¸ëžœìž­ì…˜ì„ ì‹œìž‘í•  ìˆ˜ ìžˆê¸° ë•Œë¬¸ì—, í™•ì‹¤í•˜ê²Œ `íŠ¸ëžœìž­ì…˜ ì´ ì²˜ë¦¬ ì‹œê°„`ì€ ê°ì†Œí•˜ì˜€ë‹¤. ê·¸ëŸ¬ë‚˜ ì „ì²´ ì²˜ë¦¬ ì‹œê°„ì€ ì¦ê°€í–ˆë‹¤ëŠ”ê²ƒìœ¼ë¡œ ë¯¸ë£¨ì–´ ë³´ì•˜ì„ë•Œ, ë½ì„ íšë“í•˜ëŠ” ì‹œê°„ì´ ë¹„ê´€ì  ë½ì— ë¹„í•´ì„œ ë” ëŠë ¤ì§„ë‹¤ê³  ìƒê°í•´ë³¼ ìˆ˜ ìžˆì—ˆë‹¤.
Redlock ë°©ì‹ì—ëŠ” ì•žì„œ ì†Œê°œí–ˆë˜ê²ƒì²˜ëŸ¼ ë„¤íŠ¸ì›Œí¬ ë¹„ìš©ì´ ë°œìƒí•˜ë©°, ìš”ì²­ ìž¬ì‹œë„ê¹Œì§€ ë”œë ˆì´ê°€ ë°œìƒí•œë‹¤. ë§Œì•½ ìž¬ì‹œë„ ìš”ì²­ ë”œë ˆì´ê°€ 400msì¸ë° ìž¬ì‹œë„ ìš”ì²­ì„ í•˜ê³  1ms ë’¤ì— ë½ì´ í•´ì œë˜ì—ˆë‹¤ë©´, ë‹¤ì‹œ ë½ì„ íšë“í•˜ê¸° ìœ„í•´ 399msë¥¼ ê¸°ë‹¤ë ¤ì•¼í•¨ì„ ì˜ë¯¸í•œë‹¤.

ì´ì™€ ê°™ì€ ì‹œê°„ì´ ëˆ„ì ë˜ì–´ì„œ ê²°êµ­ íŠ¸ëžœìž­ì…˜ ë‚´ì—ì„œ dbì˜ ë½ì„ ì¦‰ì‹œ íšë“í• ë•Œë³´ë‹¤ ë§Žì´ ëŠ¦ì–´ì§ˆ ìˆ˜ ë°–ì— ì—†ì—ˆì„ ê²ƒì´ë‹¤.

#### Pub/Sub

- Pub/Sub ë°©ì‹ í…ŒìŠ¤íŠ¸ ê²°ê³¼
  ![alt text](docs/images/ìž¬ê³ ê°ì†Œ_Pubsub_1000ê°œ.png)

ì˜ˆìƒë³´ë‹¤ Redlock ë°©ì‹ì˜ ë¶„ì‚°ë½ì´ ì„±ëŠ¥ì´ ë„ˆë¬´ ëŠë ·ë˜ íƒ“ì— ì¡°ê¸ˆ ë” ì„±ëŠ¥ì´ ë‚˜ì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” Pub/Sub ë°©ì‹ì„ êµ¬í˜„í•´ë³´ê³  ì„±ëŠ¥ì„ ì¸¡ì •í•´ë³´ê²Œ ë˜ì—ˆë‹¤.

í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ê¸° ì „ Redlock ë°©ì‹ë³´ë‹¤ëŠ” ì„±ëŠ¥ì—ì„œ í™•ì‹¤ížˆ ìš°ìœ„ì— ìžˆì„ ê²ƒì´ë¼ê³  ì˜ˆìƒí•˜ì˜€ê³ , ì—­ì‹œë‚˜ 11000msëŒ€ë¡œ ë§ˆì§€ë§‰ ìš”ì²­ì„ ì²˜ë¦¬í–ˆë˜ ë¹„ê´€ì  ë½ì— ë¹„í•´ ë” ë¹ ë¥¸ 7000msë¡œ ë§ˆì§€ë§‰ ìš”ì²­ì„ ì²˜ë¦¬í•˜ë©° ë” ë‚˜ì€ ì²˜ë¦¬ ì†ë„ë¥¼ ë³´ì˜€ë‹¤.

ì´ëŠ” 6000msì˜€ë˜ ë¹„ê´€ì  ë½ê³¼ ë¹„êµí•´ë³´ì•˜ì„ ë•Œ í° ì°¨ì´ê°€ ë‚˜ì§€ ì•ŠëŠ” ì†ë„ì˜€ë‹¤. ê·¸ë ‡ë‹¤ë©´ ì´ 1000msì˜ ì‹œê°„ì°¨ëŠ” ì–´ë–¤ ë¶€ë¶„ì—ì„œ ë°œìƒí•œ ê²ƒì¼ê¹Œ? ì‹¤ì‹œê°„ì— ê±°ì˜ ê°€ê¹Œìš´ pub/sub ë°©ì‹ì´ë¼ëŠ” ì ì„ ë¯¸ë£¨ì–´ ë³´ì•˜ì„ë•Œ, ì´ ì‹œê°„ ì°¨ì´ëŠ” ë„¤íŠ¸ì›Œí¬ ë¹„ìš©ì— ì˜í•´ ë°œìƒí•œ ì‹œê°„ì´ë¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìžˆì—ˆë‹¤.

ìš°ì„  ì´ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì„±ëŠ¥ì„ ê°€ìž¥ ìµœìš°ì„ ìœ¼ë¡œ ê³ ë ¤í•˜ì—¬, ì„±ëŠ¥ì´ ë›°ì–´ë‚œ Pub/Sub ë°©ì‹ì„ ì±„íƒí•˜ê¸°ë¡œ í•˜ì˜€ë‹¤.

ê·¸ëŸ¬ë‚˜ ì´ ë°©ì‹ì´ ì†ë„ê°€ ë¹ ë¥´ë‹¤ê³ í•´ì„œ ë§ŒëŠ¥ì¸ê²ƒì€ ì•„ë‹ˆë‹¤. ì´ ë°©ì‹ ì—­ì‹œ ë§Žì€ ì–‘ì˜ ìš”ì²­ì´ ë°œìƒí•˜ë©´ ê·¸ ë§Œí¼ redisì— ë³‘ëª©ì´ ë°œìƒí•˜ê²Œ ë˜ê³ , ì´ ê³¼ì •ì—ì„œ ìœ ì‹¤ë˜ëŠ” ë©”ì‹œì§€ê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ìƒê¸´ë‹¤. ì´ì— ë”°ë¼ ì¶”ê°€ì ì¸ ë©”ì‹œì§€ ë¸Œë¡œì»¤ë¥¼ ë„ìž…í•˜ì—¬ ê°€ìš©ì„±ê³¼ í™•ìž¥ì„±ì„ ë³´ìž¥í•  ìˆ˜ ìžˆì„ ê²ƒì´ë‹¤.

### ê²°ë¡ 

ì´ë²ˆ ì£¼ì°¨ë¥¼ ìˆ˜í–‰í•˜ë©°, ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ì–´ë–¤ ë½ì´ ì ì ˆí•œì§€ íŒë‹¨í•  ìˆ˜ ìžˆëŠ” ëŠ¥ë ¥ì´ ì¡°ê¸ˆì´ë‚˜ë§ˆ ê¸¸ëŸ¬ì§„ ê²ƒ ê°™ë‹¤. ë˜í•œ ì´ ê³¼ì •ì—ì„œ ì§ì ‘ ëª¨ë“  ì¼€ì´ìŠ¤ë“¤ì„ êµ¬í˜„í•´ë³´ë©°, ì˜ˆìƒê³¼ëŠ” ë‹¬ëžë˜ ë¶€ë¶„ë“¤ì— ëŒ€í•´ì„œë„ ì§ì ‘ ì¦ëª…í•´ê°€ëŠ” ê³¼ì •ì—ì„œ ë§Žì€ ê²ƒë“¤ì„ ë°°ìš¸ ìˆ˜ ìžˆì—ˆë‹¤.

ì–´ë– í•œ ê¸°ìˆ ì  ì„ íƒì—ëŠ” ì¶©ë¶„í•œ ê³ ë¯¼ê³¼ ê·¼ê±°ê°€ í•„ìš”í•˜ë©°, ê·¼ê±°ë¥¼ ë’· ë°›ì¹¨í•˜ê¸° ìœ„í•´ì„œ ì–´ì„¤í”ˆ ì¶”ì¸¡ë³´ë‹¤ëŠ” í™•ì‹¤í•œ ì¦ëª…ì´ í•„ìš”í•˜ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìžˆì—ˆë˜ í•œ ì£¼ ì˜€ë‹¤.

# Milestone

![alt text](docs/images/milestone.png)

# E-Commerce Sequence Diagram

### ðŸ’°ìž”ì•¡ API

**ìž”ì•¡ ì¶©ì „ API**

```mermaid
sequenceDiagram
  Controller ->> ChargeUserUseCase: ì‚¬ìš©ìž ìž”ì•¡ ì¶©ì „ ìš”ì²­ (userId, amount)
  ChargeUserUseCase ->> Database: ì‚¬ìš©ìž ìž”ì•¡ ì¶©ì „ ì¿¼ë¦¬
  Database -->> ChargeUserUseCase: ì‚¬ìš©ìž ë°ì´í„° ë°˜í™˜
  ChargeUserUseCase -->> Controller: ì‚¬ìš©ìž ë°ì´í„° ë°˜í™˜
```

**ìž”ì•¡ ì¡°íšŒ API**

```mermaid
sequenceDiagram
  Controller ->> ReadUserUseCase: ì‚¬ìš©ìž ì¡°íšŒ ìš”ì²­ (userId)
  ReadUserUseCase ->> Database: ì‚¬ìš©ìž ì¡°íšŒ ì¿¼ë¦¬
  Database -->> ReadUserUseCase: ì‚¬ìš©ìž ë°ì´í„° ë°˜í™˜
  ReadUserUseCase -->> Controller: ì‚¬ìš©ìž ë°ì´í„° ë°˜í™˜
```

### ðŸ“±ìƒí’ˆ ì¡°íšŒ API

**ì „ì²´ ìƒí’ˆ ì¡°íšŒ**

```mermaid
sequenceDiagram
  Controller ->> BrowseProductsUseCase: ì „ì²´ ìƒí’ˆ ì¡°íšŒ ìš”ì²­
  BrowseProductsUseCase ->> Database: ì „ì²´ ìƒí’ˆ ì¡°íšŒ ì¿¼ë¦¬
  Database -->> BrowseProductsUseCase: ì „ì²´ ìƒí’ˆ ë°ì´í„° ë°˜í™˜
  BrowseProductsUseCase -->> Controller: ì „ì²´ ìƒí’ˆ ë°ì´í„° ë°˜í™˜
```

**íŠ¹ì • ìƒí’ˆ ì¡°íšŒ**

```mermaid
sequenceDiagram
  Controller ->> ReadProductUseCase: ë‹¨ê±´ ìƒí’ˆ ì¡°íšŒ ìš”ì²­ (productId)
  ReadProductUseCase ->> Database: ë‹¨ê±´ ìƒí’ˆ ì¡°íšŒ ì¿¼ë¦¬
  Database -->> ReadProductUseCase: ë‹¨ê±´ ìƒí’ˆ ë°ì´í„° ë°˜í™˜
  ReadProductUseCase -->> Controller: ë‹¨ê±´ ìƒí’ˆ ë°ì´í„° ë°˜í™˜
```

**ìƒìœ„ ìƒí’ˆ ì¡°íšŒ**

```mermaid
sequenceDiagram
  Controller ->> BrowsePopularProductsFacadeUseCase: íŠ¹ì • ê¸°ê°„ ë™ì•ˆì˜ ìƒìœ„ ìƒí’ˆ ì¡°íšŒ ìš”ì²­(from, to)
  BrowsePopularProductsFacadeUseCase ->> Database: íŠ¹ì • ê¸°ê°„ ë™ì•ˆì˜ íŒë§¤ëŸ‰ ìƒìœ„ 5ê°œ í•­ëª© ì¡°íšŒ ì¿¼ë¦¬
  Database -->> BrowsePopularProductsFacadeUseCase: ì¡°íšŒ ë°ì´í„° ë°˜í™˜
  BrowsePopularProductsFacadeUseCase ->> ReadProductUseCase: ì¡°íšŒëœ ìƒìœ„ ìƒí’ˆì˜ ìƒì„¸ ì •ë³´ ì¡°íšŒ ìš”ì²­
  ReadProductUseCase -->> BrowsePopularProductsFacadeUseCase: ê° ìƒí’ˆ ë°ì´í„° ìƒì„¸ì •ë³´ ì¡°íšŒ ê²°ê³¼ ë°˜í™˜
  BrowsePopularProductsFacadeUseCase -->> Controller: ê²°ê³¼ ë°˜í™˜
```

### ðŸ’¸ì£¼ë¬¸ / ê²°ì œ API

#### ì£¼ë¬¸ ìƒì„±

```mermaid
sequenceDiagram
    Client->>OrderController: POST /api/v1/orders (CreateOrderFacadeDto)
    OrderController->>CreateOrderFacadeUseCase: execute(CreateOrderFacadeDto)
    CreateOrderFacadeUseCase->>DataSource: transaction ì‹œìž‘
    loop ê° ìƒí’ˆ ì˜µì…˜ì— ëŒ€í•´
        CreateOrderFacadeUseCase->>DecreaseProductStockUseCase: execute(DecreaseProductStockDto)
        DecreaseProductStockUseCase-->>CreateOrderFacadeUseCase: ìž¬ê³  ê°ì†Œ ê²°ê³¼
    end
    CreateOrderFacadeUseCase->>CreateOrderUseCase: execute(CreateOrderFacadeDto)
    CreateOrderUseCase-->>CreateOrderFacadeUseCase: OrderDto
    CreateOrderFacadeUseCase->>CreatePaymentUseCase: execute(PaymentDto)
    CreatePaymentUseCase-->>CreateOrderFacadeUseCase: ê²°ì œ ì´ˆê¸° ë°ì´í„° ìƒì„± ê²°ê³¼
    CreateOrderFacadeUseCase->>EventEmitter: emit('order.created', {orderId})
    DataSource-->>CreateOrderFacadeUseCase: transaction ì™„ë£Œ
    CreateOrderFacadeUseCase-->>OrderController: OrderDto
    OrderController-->>Client: 201 Created (OrderDto)
```

#### ê²°ì œ ì²˜ë¦¬

```mermaid
sequenceDiagram
    Controller->>CompletePaymentFacadeUseCase: execute(CompletePaymentFacadeDto)
    CompletePaymentFacadeUseCase->>DataSource: transaction ì‹œìž‘
    DataSource-->>CompletePaymentFacadeUseCase: EntityManager ì œê³µ
    CompletePaymentFacadeUseCase->>Database: ê²°ì œ ì •ë³´ ì¡°íšŒ
    Database-->>CompletePaymentFacadeUseCase: PaymentEntity ë°˜í™˜
    CompletePaymentFacadeUseCase->>Database: ì£¼ë¬¸ ì •ë³´ ì¡°íšŒ
    Database-->>CompletePaymentFacadeUseCase: OrderEntity ë°˜í™˜
    CompletePaymentFacadeUseCase->>Database: ì£¼ë¬¸ í•­ëª© ì¡°íšŒ
    Database-->>CompletePaymentFacadeUseCase: OrderItemEntity[] ë°˜í™˜
    CompletePaymentFacadeUseCase->>AccumulatePopularProductsSoldUseCase: execute(AccumulatePopularProductsSoldDto)
    AccumulatePopularProductsSoldUseCase->>Database: ì¸ê¸° ìƒí’ˆ íŒë§¤ëŸ‰ ëˆ„ì 
    Database-->>AccumulatePopularProductsSoldUseCase: ëˆ„ì  ì™„ë£Œ
    AccumulatePopularProductsSoldUseCase-->>CompletePaymentFacadeUseCase: ì‹¤í–‰ ì™„ë£Œ
    CompletePaymentFacadeUseCase->>SpendUserBalanceUsecase: execute(SpendBalanceDto)
    SpendUserBalanceUsecase->>Database: ì‚¬ìš©ìž ìž”ì•¡ ì°¨ê°
    Database-->>SpendUserBalanceUsecase: ì°¨ê° ì™„ë£Œ
    SpendUserBalanceUsecase-->>CompletePaymentFacadeUseCase: ì‹¤í–‰ ì™„ë£Œ
    CompletePaymentFacadeUseCase->>CompletePaymentUseCase: execute(CompletePaymentDto)
    CompletePaymentUseCase->>Database: ê²°ì œ ì™„ë£Œ ì²˜ë¦¬
    Database-->>CompletePaymentUseCase: ì²˜ë¦¬ ì™„ë£Œ
    CompletePaymentUseCase-->>CompletePaymentFacadeUseCase: PaymentResultDto ë°˜í™˜
    alt íŠ¸ëžœìž­ì…˜ ì„±ê³µ
        DataSource-->>CompletePaymentFacadeUseCase: íŠ¸ëžœìž­ì…˜ ì»¤ë°‹
        CompletePaymentFacadeUseCase-->>Controller: PaymentResultDto ë°˜í™˜
    else íŠ¸ëžœìž­ì…˜ ì‹¤íŒ¨
        DataSource-->>CompletePaymentFacadeUseCase: íŠ¸ëžœìž­ì…˜ ë¡¤ë°±
        CompletePaymentFacadeUseCase->>Database: ê²°ì œ ì‹¤íŒ¨ ìƒíƒœ ì—…ë°ì´íŠ¸
        CompletePaymentFacadeUseCase->>Database: ì£¼ë¬¸ ì·¨ì†Œ ìƒíƒœ ì—…ë°ì´íŠ¸
        CompletePaymentFacadeUseCase-->>Controller: ì—ëŸ¬ throw
    end
```

### ðŸ›’ìž¥ë°”êµ¬ë‹ˆ API

**ìž¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ì¶”ê°€ API**

```mermaid
sequenceDiagram
    Controller->>AddCartUseCase: execute(AddCartProductDetailDto)
    AddCartUseCase->>Database: ìƒí’ˆ ì˜µì…˜ ì¡°íšŒ (productOptionId)
    Database-->>AddCartUseCase: ProductOptionEntity ë°˜í™˜
    alt ìƒí’ˆ ì˜µì…˜ì´ ì¡´ìž¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°
        AddCartUseCase-->>Controller: NOT_FOUND_PRODUCT_OPTION_ERROR ë°œìƒ
    else ìƒí’ˆ ì˜µì…˜ì´ ì¡´ìž¬í•˜ëŠ” ê²½ìš°
        AddCartUseCase->>Database: ìž¥ë°”êµ¬ë‹ˆ í•­ëª© ìƒì„± (userId, productOptionId, quantity)
        Database-->>AddCartUseCase: ìƒì„±ëœ CartEntity ë°˜í™˜
        AddCartUseCase->>AddCartUseCase: CartDto ìƒì„±
        AddCartUseCase-->>Controller: CartDto ë°˜í™˜
    end
```

**ìž¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ì‚­ì œ API**

```mermaid
sequenceDiagram
    Controller->>DeleteCartUseCase: execute(cartId)
    DeleteCartUseCase->>Database: ìž¥ë°”êµ¬ë‹ˆ í•­ëª© ì‚­ì œ (cartId)
    Database-->>DeleteCartUseCase: ì‚­ì œ ê²°ê³¼ ë°˜í™˜
    DeleteCartUseCase-->>Controller: void (ì‚­ì œ ì™„ë£Œ)
```

**ìž¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ì¡°íšŒ API**

```mermaid
sequenceDiagram
    Controller->>BrowseCartUseCase: execute(userId)
    BrowseCartUseCase->>Database: ì‚¬ìš©ìžì˜ ìž¥ë°”êµ¬ë‹ˆ í•­ëª© ì¡°íšŒ (userId)
    Database-->>BrowseCartUseCase: ìž¥ë°”êµ¬ë‹ˆ í•­ëª© ë°˜í™˜
    alt ìž¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìžˆëŠ” ê²½ìš°
        BrowseCartUseCase-->>Controller: ë¹ˆ ë°°ì—´ ë°˜í™˜
    else ìž¥ë°”êµ¬ë‹ˆì— í•­ëª©ì´ ìžˆëŠ” ê²½ìš°
        BrowseCartUseCase->>Database: ìƒí’ˆ ì˜µì…˜ ì •ë³´ ì¡°íšŒ (productOptionIds)
        Database-->>BrowseCartUseCase: ìƒí’ˆ ì˜µì…˜ ì •ë³´ ë°˜í™˜
        loop ê° ìž¥ë°”êµ¬ë‹ˆ í•­ëª©ì— ëŒ€í•´
            BrowseCartUseCase->>BrowseCartUseCase: CartDto ìƒì„±
        end
        BrowseCartUseCase-->>Controller: CartDto ë°°ì—´ ë°˜í™˜
    end
```

# E-commerce ERDiagram

```mermaid
erDiagram
  users {
    long id
    varchar name
    int balance
    datetime deletedAt
  }

  products {
    long id
    varchar name
    enum status
    datetime deletedAt
  }

  product_options {
    long id
    varchar name
    long price
    int stock
    long productId
  }

  orders {
    long id
    long userId
    long totalPrice
    enum status
    datetime orderedAt
    datetime deletedAt
  }

  order_items {
    long id
    long orderId
    long productOptionId
    varchar productName
    int quantity
    long totalPriceAtOrder
    datetime deletedAt
  }

  payments {
    long id
    long userId
    long orderId
    long amount
    enum paymentMethod
    enum status
    datetime paidAt
    datetime deletedAt
  }

  carts {
    long id
    long userId
    long productOptionId
    int quantity
    datetime deletedAt
  }

  daily_popular_products {
    long id
    long productId
    long productOptionId
    int totalSold
    date soldDate
    datetime updatedAt
  }

  users ||--|| carts : "has"
  users ||--o{ orders : "has"
  orders ||--o{ order_items : "contains"
  products ||--o{ order_items : "is in"
  products ||--o{ product_options: "contains"
  product_options ||--o{ daily_popular_products : "is"
  orders ||--|| payments : "has"
```
